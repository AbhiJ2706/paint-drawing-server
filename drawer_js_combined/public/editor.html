<html>
<head>
    <link rel="shortcut icon" href="">
</head>
<body>
    <div id="top" style="width:100%; height:40px">
        <input type="range" id="lineControllerWidth" style="float:top; width:800px" min="1" max="800" />
        <div style="float:right; width:40%">
            <button style="width:49%" onclick="showPenControls()">Pen</button>
        </div>
    </div>
    <div id="centralCanvas" style="width:60%; float:left">
        <canvas id="c2" style="z-index:2; float:left; border:3px solid black; position:absolute" width="800" height="600"></canvas>
        <canvas id="utility" style="z-index:10000; float:left; border:3px solid black; position:absolute" width="800" height="600"></canvas>
        <input type="range" orient="vertical" id="lineControllerHeight" style="float:right; height:600px" min="1" max="600" />
    </div>
    <div id="right" style="float:right; width:40%; display:block">
        <div id="pen" style="visibility:hidden; display:none; height:59%; width:100%">
            <button id="setToPen">Pen</button>
            <button id="setToFill">Fill</button>
            <button id="setToErase">Erase</button>
        </div>
        <div id="bottom" style="height:40%; width:100%">
            <button id="blue" style="width:9%; height:9%; background-color:#0000FF" onclick="receiveBlue()"></button>
            <button id="red" style="width:9%; height:9%; background-color:#FF0000" onclick="receiveRed()"></button>
            <button id="green" style="width:9%; height:9%; background-color:#00FF00" onclick="receiveGreen()"></button>
            <button id="yellow" style="width:9%; height:9%; background-color:#FFF700" onclick="receiveYellow()"></button>
            <button id="orange" style="width:9%; height:9%; background-color:#FFB700" onclick="receiveOrange()"></button>
            <button id="purple" style="width:9%; height:9%; background-color:#D400FF" onclick="receivePurple()"></button>
            <button id="black" style="width:9%; height:9%; background-color:#000000" onclick="receiveBlack()"></button>
            <button id="white" style="width:9%; height:9%; background-color:#FFFFFF" onclick="receiveWhite()"></button>
            <button id="pink" style="width:9%; height:9%; background-color:#FF7DDE" onclick="receivePink()"></button>
            <button id="turquoise" style="width:9%; height:9%; background-color:#25F5DE" onclick="receiveTurquoise()"></button>
            <input type="range" id="thicknessSlider" style="width:100%" min="2" max="96"/>
            <div id="finish">
                <button id="downloadToComputer" onclick="dlCanvas()">Save and download</button>
                <button id="uploadToServer" onclick="submitImg()">Save and upload</button>
                <button id="displayPics" onclick="dispImgs()">See what others have drawn</button>
                <form id="imgSubmitter" enctype="multipart/form-data" action="api/Upload/" method="post" style="visibility:hidden">
                    <input id="imgSubmitInput" name="imgUploader" type="text">
                </form>
            </div>
        </div>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

    function showPenControls(){
        inLineMode = false;
        document.getElementById("pen").style.visibility = "visible"
        document.getElementById("pen").style.display = "block"
    }

    function submitImg(){
        var email = sessionStorage.getItem('email')
        var username = sessionStorage.getItem('username')
        console.log("upload button clicked")
        var a = document.getElementById("c2").toDataURL("image/png");
        console.log(a)
        $.post("http://localhost:8000/api/Upload", {img: a, em: email, usr: username}, function(data){
            console.log(data);
        }) 
    }

    function dlCanvas() {
        var dlLink = document.createElement("a");
        var dt = document.getElementById("c2").toDataURL('image/png');
        dt = dt.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');
        dt = dt.replace(/^data:application\/octet-stream/, 'data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=Canvas.png');
        dlLink.href = dt;
        dlLink.download = "Canvas.png"
        dlLink.click();
    };

    function dispImgs(){
        $.post("http://localhost:8000/api/goToDisplay").done(function(){
            window.location.assign('/display')
        });
    }

</script>
<script src="penDrawer.mjs"></script>
<script> 

    document.addEventListener("mousemove", draw, false);
    document.addEventListener("mousedown", setDraw, false);  
    document.addEventListener("mouseup", unSetDraw, false);   

    var c2 = document.getElementById("c2");
    var utility = document.getElementById("utility");

    var thickness = document.getElementById("thicknessSlider");

    var penModule = new penDrawer(c2);

    var inLineMode = false;

    function draw(e){
        penModule.draw(e);
    }

    function setDraw(e){
        penModule.setDraw(e);
    }

    function unSetDraw(e){
        penModule.unSetDraw();
    }

    thickness.onchange = function(){
        penModule.setThickness(thickness.value);
    }

    function receiveBlue(){
        penModule.receiveFillStyle("#0000FF");
    }

    function receiveRed(){
        penModule.receiveFillStyle("#FF0000");
    }

    function receiveGreen(){
        penModule.receiveFillStyle("#00FF00");
    }

    function receiveYellow(){
        penModule.receiveFillStyle("#FFF200");
    }

    function receiveOrange(){
        penModule.receiveFillStyle("#FFB700");
    }

    function receivePurple(){
        penModule.receiveFillStyle("#D400FF");
    }

    function receiveBlack(){
        penModule.receiveFillStyle("#000000");
    }

    function receiveWhite(){
        penModule.receiveFillStyle("#FFFFFF");
    }

    function receivePink(){
        penModule.receiveFillStyle("#FF7DDE");
    }

    function receiveTurquoise(){
        penModule.receiveFillStyle("#25F5DE");
    }

</script>
</html>